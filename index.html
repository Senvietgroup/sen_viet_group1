<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng K√Ω Nh√¢n Vi√™n - Sen Viet Group</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Roboto h·ªó tr·ª£ Ti·∫øng Vi·ªát t·ªët nh·∫•t -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- HTML5-QRCode Library -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        /* √Åp d·ª•ng ph√¥ng Roboto cho to√†n b·ªô trang */
        body { font-family: 'Roboto', sans-serif; background-color: #fff7ed; position: relative; overflow-x: hidden; } /* M√†u n·ªÅn cam nh·∫°t ·∫•m √°p cho T·∫øt */
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c2410c; border-radius: 4px; } /* M√†u cam ƒë·∫≠m */
        ::-webkit-scrollbar-thumb:hover { background: #9a3412; }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #fff; 
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        /* Input Focus Effects */
        .input-group:focus-within label {
            color: #d97706; /* Amber-600 - M√†u v√†ng ƒë·ªìng */
        }
        .input-group:focus-within i {
            color: #d97706; /* Amber-600 */
        }
        input:focus, select:focus, textarea:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(217, 119, 6, 0.1), 0 2px 4px -1px rgba(217, 119, 6, 0.06);
            border-color: #fbbf24; /* Amber-400 */
        }

        /* Button Hover Effects */
        .btn-hover-effect {
            transition: all 0.3s ease;
        }
        .btn-hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-hover-effect:active {
            transform: translateY(0);
        }

        /* Gradient Brand Color - T·∫øt Theme (Red/Gold) */
        .bg-brand-gradient {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%); /* Red to Orange */
        }
        
        /* Toast notification */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
        }
        .preview-box {
            position: relative;
            aspect-ratio: 8/5;
            background-color: #fff;
            border: 2px dashed #fcd34d; /* V√†ng */
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .preview-box:hover {
            border-color: #dc2626; /* ƒê·ªè */
            background-color: #fff1f2;
        }
        .preview-box img { width: 100%; height: 100%; object-fit: cover; }
        .preview-label { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.6); color: white; padding: 4px; font-size: 0.75rem; text-align: center; }
        
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        input[type="date"] { appearance: none; -webkit-appearance: none; position: relative; }

        /* TET EFFECT CSS */
        .tet-item {
            position: fixed;
            top: -50px;
            z-index: 9999;
            pointer-events: none;
            user-select: none;
            cursor: default;
            animation-name: fall-tet;
            animation-timing-function: linear;
        }
        
        @keyframes fall-tet {
            0% { transform: translateY(-50px) rotate(0deg) translateX(0px); opacity: 1; }
            25% { transform: translateY(25vh) rotate(90deg) translateX(20px); }
            50% { transform: translateY(50vh) rotate(180deg) translateX(-20px); }
            75% { transform: translateY(75vh) rotate(270deg) translateX(20px); }
            100% { transform: translateY(110vh) rotate(360deg) translateX(0px); opacity: 0; }
        }
    </style>
</head>
<body class="bg-orange-50 min-h-screen flex items-center justify-center p-2 sm:p-4">

    <!-- Container for Tet Effects (Created via JS) -->
    <div id="tet-container"></div>

    <div class="w-full max-w-xl bg-white shadow-2xl rounded-2xl overflow-hidden animate-fade-in-up border border-orange-100 relative z-10">
        
        <!-- Header v·ªõi Gradient v√† Logo -->
        <div class="bg-brand-gradient p-6 text-white text-center relative overflow-hidden">
            <!-- Decorative Circles (Lantern Glows) -->
            <div class="absolute top-0 right-0 -mr-8 -mt-8 w-32 h-32 rounded-full bg-yellow-300 opacity-20 blur-xl"></div>
            <div class="absolute bottom-0 left-0 -ml-8 -mb-8 w-24 h-24 rounded-full bg-yellow-300 opacity-20 blur-xl"></div>

            <!-- Decorative Branch -->
             <div class="absolute top-0 left-0 opacity-20 transform -rotate-12 text-6xl pointer-events-none">üå∏</div>
             <div class="absolute bottom-2 right-2 opacity-20 transform rotate-12 text-5xl pointer-events-none">üåº</div>

            <!-- Logo Container -->
            <div class="absolute top-4 left-4">
                <img src="logo.png.jpg" 
                     onerror="this.src='https://placehold.co/100x100/red/white?text=SV'" 
                     alt="Sen Viet Group" 
                     class="h-12 w-12 sm:h-14 sm:w-14 object-contain bg-white rounded-full p-1 shadow-md border-2 border-yellow-200 backdrop-blur-sm">
            </div>

            <div class="inline-block px-3 py-1 rounded-full bg-yellow-400/30 text-yellow-50 text-xs font-bold mb-1 border border-yellow-200/50">
                ‚ú® CH√öC M·ª™NG NƒÇM M·ªöI 2026 ‚ú®
            </div>
            <h1 class="text-2xl sm:text-3xl font-bold uppercase tracking-wide drop-shadow-md mt-1">Sen Vi·ªát Group</h1>
            <p class="text-white/90 text-sm mt-1 font-light italic">V·∫°n s·ª± nh∆∞ √Ω - An khang th·ªãnh v∆∞·ª£ng</p>
        </div>

        <div class="p-6 space-y-6">
            
            <!-- --- QR SECTION --- -->
            <div class="bg-orange-50 p-2 rounded-xl border border-orange-200 shadow-inner">
                <button onclick="toggleQrScanner()" id="btn-scan-qr" class="w-full flex items-center justify-center p-4 bg-white border border-orange-200 rounded-lg shadow-sm hover:bg-orange-100 text-orange-700 font-bold transition-all duration-300 group">
                    <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mr-3 group-hover:bg-orange-200 transition-colors text-red-600">
                        <i class="fa-solid fa-qrcode text-xl"></i>
                    </div>
                    <span id="btn-scan-text">Qu√©t QR (M·∫∑t tr∆∞·ªõc / Sau)</span>
                </button>

                <!-- N√∫t T·∫£i ·∫¢nh QR -->
                <div class="mt-3 text-center">
                    <input type="file" id="qr-input-file" accept="image/*" class="hidden" onchange="handleQrFileUpload(this)">
                    <label for="qr-input-file" class="cursor-pointer inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-orange-700 bg-white border border-orange-200 rounded-lg hover:bg-orange-50 transition-colors shadow-sm">
                        <i class="fa-solid fa-image mr-2 text-red-500"></i>
                        <span>Ho·∫∑c t·∫£i ·∫£nh m√£ QR l√™n</span>
                    </label>
                </div>
                
                <!-- QR Scanner Container -->
                <div id="qr-wrapper" class="hidden mt-3 p-2 bg-white rounded-lg border border-gray-200 shadow-sm">
                    <div id="qr-reader" class="rounded-lg overflow-hidden bg-black"></div>
                </div>
            </div>

            <div class="relative flex py-2 items-center">
                <div class="flex-grow border-t border-gray-300"></div>
                <span class="flex-shrink-0 mx-4 text-gray-400 text-xs uppercase font-medium tracking-wider">Ho·∫∑c t·∫£i ·∫£nh l√™n</span>
                <div class="flex-grow border-t border-gray-300"></div>
            </div>

            <!-- --- PHOTO UPLOAD SECTION (FRONT & BACK) --- -->
            <div class="grid grid-cols-2 gap-4">
                <!-- FRONT SIDE -->
                <div>
                    <!-- ƒê√£ b·ªè capture="environment" ƒë·ªÉ cho ph√©p ch·ªçn ·∫£nh t·ª´ th∆∞ vi·ªán -->
                    <input id="file-front" type="file" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'front')">
                    <label for="file-front" class="cursor-pointer block group h-full">
                        <div class="preview-box group-hover:border-orange-400 h-full" id="preview-box-front">
                            <div class="text-center text-gray-400 p-2 group-hover:text-orange-500 transition-colors">
                                <i class="fa-solid fa-id-card text-4xl mb-2 transition-transform group-hover:scale-110 text-orange-300 group-hover:text-orange-500"></i>
                                <div class="text-xs font-medium">M·∫∑t tr∆∞·ªõc CCCD</div>
                            </div>
                            <img id="img-front" class="hidden" src="">
                            
                            <!-- Rotate Button Front -->
                            <button type="button" onclick="event.preventDefault(); rotateImage('front')" id="btn-rotate-front" class="absolute top-2 right-2 bg-black/60 hover:bg-black/80 text-white w-8 h-8 rounded-full hidden flex items-center justify-center z-20 transition-all shadow-md" title="Xoay ·∫£nh 90 ƒë·ªô">
                                <i class="fa-solid fa-rotate-right text-sm"></i>
                            </button>

                            <div id="loading-front" class="absolute inset-0 bg-white/90 hidden flex-col items-center justify-center z-10 backdrop-blur-sm">
                                <div class="loader mb-2 border-t-orange-500"></div>
                                <span class="text-xs text-orange-600 font-bold animate-pulse">ƒêang x·ª≠ l√Ω...</span>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- BACK SIDE -->
                <div>
                    <!-- ƒê√£ b·ªè capture="environment" ƒë·ªÉ cho ph√©p ch·ªçn ·∫£nh t·ª´ th∆∞ vi·ªán -->
                    <input id="file-back" type="file" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'back')">
                    <label for="file-back" class="cursor-pointer block group h-full">
                        <div class="preview-box group-hover:border-orange-400 h-full" id="preview-box-back">
                            <div class="text-center text-gray-400 p-2 group-hover:text-orange-500 transition-colors">
                                <i class="fa-regular fa-id-card text-4xl mb-2 transition-transform group-hover:scale-110 text-orange-300 group-hover:text-orange-500"></i>
                                <div class="text-xs font-medium">M·∫∑t sau CCCD</div>
                            </div>
                            <img id="img-back" class="hidden" src="">

                            <!-- Rotate Button Back -->
                            <button type="button" onclick="event.preventDefault(); rotateImage('back')" id="btn-rotate-back" class="absolute top-2 right-2 bg-black/60 hover:bg-black/80 text-white w-8 h-8 rounded-full hidden flex items-center justify-center z-20 transition-all shadow-md" title="Xoay ·∫£nh 90 ƒë·ªô">
                                <i class="fa-solid fa-rotate-right text-sm"></i>
                            </button>

                            <div id="loading-back" class="absolute inset-0 bg-white/90 hidden flex-col items-center justify-center z-10 backdrop-blur-sm">
                                <div class="loader mb-2 border-t-orange-500"></div>
                                <span class="text-xs text-orange-600 font-bold animate-pulse">ƒêang x·ª≠ l√Ω...</span>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- --- FORM --- -->
            <form id="employeeForm" onsubmit="submitForm(event)" class="space-y-5 pt-2">
                
                <!-- Job Info Section -->
                <div class="bg-orange-50/80 p-4 rounded-xl border border-orange-200 space-y-4 shadow-sm hover:shadow-md transition-shadow duration-300">
                    <h3 class="text-xs font-bold text-red-700 uppercase border-b border-red-100 pb-2 mb-1 flex items-center">
                        <i class="fa-solid fa-briefcase mr-2 text-yellow-600"></i> Th√¥ng tin c√¥ng vi·ªác
                    </h3>
                    
                    <!-- Company Name -->
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">T√™n c√¥ng ty</label>
                        <div class="relative group">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400 transition-colors group-hover:text-red-500"><i class="fa-solid fa-building"></i></span>
                            <select id="company" required class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm transition-all outline-none cursor-pointer">
                                <option value="" disabled selected>-- Ch·ªçn c√¥ng ty --</option>
                                <option value="AAC CH√çNH TH·ª®C">AAC CH√çNH TH·ª®C</option>
                                <option value="AAC TH·ªúI V·ª§">AAC TH·ªúI V·ª§</option>
                                <option value="HS CH√çNH TH·ª®C">HS CH√çNH TH·ª®C</option>
                                <!-- New Companies Added Below HS CH√çNH TH·ª®C -->
                                <option value="HS TH·ªúI V·ª§">HS TH·ªúI V·ª§</option>
                                <option value="HS TH·ªúI V·ª§ L∆Ø∆†NG NG√ÄY">HS TH·ªúI V·ª§ L∆Ø∆†NG NG√ÄY</option>
                                <option value="SHUNYUN">SHUNYUN</option>
                                <option value="VINFAST">VINFAST</option>
                                <option value="SAMSUNG">SAMSUNG</option>
                                <option value="LG">LG</option>
                                <option value="JAEYOUNG">JAEYOUNG</option>
                                <option value="YUTO">YUTO</option>
                                <option value="ING VINA">ING VINA</option>
                                <option value="ASKEY CH√çNH TH·ª®C">ASKEY CH√çNH TH·ª®C</option>
                                <option value="TENMA">TENMA</option>
                                <!-- End New Companies -->
                                <option value="GOERTEK CH√çNH TH·ª®C">GOERTEK CH√çNH TH·ª®C</option>
                                <option value="GOERTEK TH·ªúI V·ª§">GOERTEK TH·ªúI V·ª§</option>
                                <option value="YUZHAN CH√çNH TH·ª®C">YUZHAN CH√çNH TH·ª®C</option>
                                <option value="YUZHAN TH·ªúI V·ª§">YUZHAN TH·ªúI V·ª§</option>
                                <option value="AUSTONE TH·ªúI V·ª§">AUSTONE TH·ªúI V·ª§</option>
                                <option value="VDS TH·ªúI V·ª§">VDS TH·ªúI V·ª§</option>
                                <option value="SOHAN TH·ªúI V·ª§">SOHAN TH·ªúI V·ª§</option>
                                <option value="LUXSHARE">LUXSHARE</option>
                                <option value="Fukang">Fukang</option>
                                <option value="Newwing">Newwing</option>
                                <option value="Fuyu">Fuyu</option>
                                <option value="Fulian">Fulian</option>
                                <option value="Lens">Lens</option>
                                <option value="Fuhong">Fuhong</option>
                                <option value="Tawlay">Tawlay</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Supplier -->
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">Nh√† cung ·ª©ng</label>
                        <div class="relative group">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400 transition-colors group-hover:text-red-500"><i class="fa-solid fa-users"></i></span>
                            <select id="supplier" required class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm transition-all outline-none cursor-pointer">
                                <option value="" disabled selected>-- Ch·ªçn nh√† cung ·ª©ng --</option>
                                <option value="Sen Vi·ªát">Sen Vi·ªát</option>
                                <option value="Sen Vi·ªát 1">Sen Vi·ªát 1</option>
                                <option value="Sen Vi·ªát 2">Sen Vi·ªát 2</option>
                                <option value="Sen Vi·ªát 3">Sen Vi·ªát 3</option>
                                <option value="Sen Vi·ªát 4">Sen Vi·ªát 4</option>
                                <option value="Sen Vi·ªát 5">Sen Vi·ªát 5</option>
                                <option value="Sen Vi·ªát 6">Sen Vi·ªát 6</option>
                                <option value="Sen Vi·ªát 7">Sen Vi·ªát 7</option>
                                <option value="Sen Vi·ªát 8">Sen Vi·ªát 8</option>
                                <option value="Sen Vi·ªát 9">Sen Vi·ªát 9</option>
                                <option value="Sen Vi·ªát 10">Sen Vi·ªát 10</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Registration Date -->
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">Ng√†y ƒêƒÉng K√≠</label>
                        <input type="date" id="registerDate" class="w-full p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm transition-all outline-none">
                    </div>

                </div>

                <!-- Personal Info Section -->
                 <div class="input-group">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">H·ªç v√† t√™n</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i class="fa-solid fa-user"></i></span>
                        <input type="text" id="fullname" required class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all outline-none" placeholder="NGUYEN VAN A">
                    </div>
                </div>

                <!-- Citizen ID -->
                <div class="input-group">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">S·ªë CCCD</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i class="fa-solid fa-id-badge"></i></span>
                        <input type="text" id="cccd" required class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all outline-none" placeholder="0xxxxxxxxxxx">
                    </div>
                </div>

                <!-- DOB & GENDER -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">Ng√†y sinh</label>
                        <input type="date" id="dob" class="w-full p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm transition-all outline-none">
                    </div>
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">Gi·ªõi t√≠nh</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i class="fa-solid fa-venus-mars"></i></span>
                            <select id="gender" class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm transition-all outline-none cursor-pointer">
                                <option value="" disabled selected>-- Ch·ªçn --</option>
                                <option value="Nam">Nam</option>
                                <option value="N·ªØ">N·ªØ</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Issue Date & Place -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">Ng√†y c·∫•p</label>
                        <input type="date" id="issueDate" class="w-full p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm transition-all outline-none">
                    </div>
                    <div class="input-group">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">N∆°i c·∫•p</label>
                         <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i class="fa-solid fa-building-gov"></i></span>
                            <input type="text" id="issuePlace" class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all outline-none" placeholder="B·ªô C√¥ng An...">
                        </div>
                    </div>
                </div>

                <!-- Address -->
                <div class="input-group">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</label>
                    <div class="relative">
                        <span class="absolute top-3 left-3 flex items-center text-gray-400"><i class="fa-solid fa-map-location-dot"></i></span>
                        <textarea id="address" rows="2" class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all outline-none" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng/x√£..."></textarea>
                    </div>
                </div>

                <!-- Phone Number -->
                <div class="input-group">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá</label>
                    <div class="relative">
                         <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i class="fa-solid fa-phone"></i></span>
                        <input type="tel" id="phone" required class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all outline-none" placeholder="09xxxxxxx">
                    </div>
                </div>

                <!-- Notes -->
                <div class="input-group">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 transition-colors">Ghi Ch√∫</label>
                    <div class="relative">
                        <span class="absolute top-3 left-3 flex items-center text-gray-400"><i class="fa-solid fa-note-sticky"></i></span>
                        <textarea id="notes" rows="2" class="w-full pl-10 p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all outline-none" placeholder="Nh·∫≠p ghi ch√∫ th√™m (n·∫øu c√≥)..."></textarea>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-5 gap-3 mt-8">
                    <button type="button" onclick="resetPage()" class="col-span-2 bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-3.5 rounded-xl shadow-sm hover:shadow transition-all duration-300 transform active:scale-95 flex justify-center items-center border border-gray-200">
                        <i class="fa-solid fa-rotate-right mr-2 transition-transform duration-500 group-hover:rotate-180"></i> NH·∫¨P L·∫†I
                    </button>
                    <button type="submit" id="submitBtn" class="col-span-3 bg-brand-gradient hover:opacity-90 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-orange-500/30 transition-all duration-300 transform active:scale-95 flex justify-center items-center btn-hover-effect">
                        <span class="mr-2">G·ª¨I ƒêƒÇNG K√ù</span> <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Footer -->
        <div class="bg-orange-50 p-4 text-center text-xs text-orange-400 border-t border-orange-200">
            &copy; 2026 Sen Vi·ªát Group. Powered by Sen Vi·ªát Group.
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // CONFIGURATION
        const GOOGLE_API_KEY = 'AIzaSyB2JUVRGd-oREdyYyvznfiZ0WAFldr8Mic'; 
        const N8N_WEBHOOK_URL = 'https://senvietgroup.com/webhook/aa821db7-c04a-4ef1-b34f-8fc4bb08d355';
        
        // --- TET 2026 EFFECT LOGIC ---
        // Replacing snow with: Peach blossom (üå∏), Apricot blossom (üåº), Red Envelope (üßß), Lantern (üèÆ)
        const tetIcons = ['üå∏', 'üåº', 'üßß', 'üèÆ'];
        
        function createTetEffect() {
            const item = document.createElement('div');
            item.classList.add('tet-item');
            
            // Randomly select an icon
            const icon = tetIcons[Math.floor(Math.random() * tetIcons.length)];
            item.innerText = icon;
            
            // Random horizontal position
            item.style.left = Math.random() * 100 + 'vw';
            
            // Random fall duration between 5s and 10s
            item.style.animationDuration = Math.random() * 5 + 5 + 's'; 
            
            // Random size between 15px and 25px
            item.style.fontSize = Math.random() * 10 + 15 + 'px';
            
            // Random opacity
            item.style.opacity = Math.random() * 0.5 + 0.5;

            document.getElementById('tet-container').appendChild(item);

            // Remove item after it falls
            setTimeout(() => {
                item.remove();
            }, 10000); // Match max animation duration
        }

        // Create a Tet item every 400ms (slower than snow for gentle effect)
        setInterval(createTetEffect, 400);

        // --- QR CODE LOGIC ---
        let html5QrcodeScanner = null;
        let isScanning = false;

        async function toggleQrScanner() {
            if (isScanning) {
                await stopQrScanner();
            } else {
                startQrScanner();
            }
        }

        async function startQrScanner() {
            if (isScanning) return; 

            const wrapper = document.getElementById('qr-wrapper');
            const btnText = document.getElementById('btn-scan-text');
            
            wrapper.classList.remove('hidden');
            btnText.innerText = "ƒêang m·ªü camera...";

            if (!html5QrcodeScanner) {
                html5QrcodeScanner = new Html5Qrcode("qr-reader");
            }

            const config = { fps: 10, qrbox: { width: 250, height: 250 }, aspectRatio: 1.0 };
            
            try {
                await html5QrcodeScanner.start(
                    { facingMode: "environment" }, 
                    config, 
                    onScanSuccess,
                    undefined
                );
                isScanning = true;
                btnText.innerText = "D·ª´ng qu√©t";
                wrapper.scrollIntoView({ behavior: 'smooth' });
                
            } catch (err) {
                console.error("Camera Error:", err);
                isScanning = false;
                wrapper.classList.add('hidden');
                btnText.innerText = "Qu√©t QR (M·∫∑t tr∆∞·ªõc / Sau)";
                
                let msg = "Kh√¥ng th·ªÉ m·ªü camera.";
                if (err.name === 'NotReadableError') msg = "Camera ƒëang b·∫≠n. H√£y t·∫Øt c√°c tab/·ª©ng d·ª•ng kh√°c d√πng camera.";
                else if (err.name === 'NotAllowedError') msg = "Vui l√≤ng c·∫•p quy·ªÅn truy c·∫≠p camera.";
                
                showToast(msg, "error");
                try { await html5QrcodeScanner.clear(); } catch(e) {}
            }
        }

        async function stopQrScanner() {
            if (!html5QrcodeScanner) return;
            document.getElementById('btn-scan-text').innerText = "ƒêang d·ª´ng...";
            
            try {
                if (html5QrcodeScanner.getState() === 2 || html5QrcodeScanner.getState() === 1) {
                     await html5QrcodeScanner.stop();
                }
                await html5QrcodeScanner.clear();
            } catch (err) {
                console.warn("Stop error:", err);
            } finally {
                isScanning = false;
                document.getElementById('qr-wrapper').classList.add('hidden');
                document.getElementById('btn-scan-text').innerText = "Qu√©t QR (M·∫∑t tr∆∞·ªõc / Sau)";
                html5QrcodeScanner = null;
            }
        }

        // --- HANDLE QR FILE UPLOAD ---
        async function handleQrFileUpload(input) {
            if (!input.files || input.files.length === 0) return;
            const file = input.files[0];

            showToast("ƒêang x·ª≠ l√Ω ·∫£nh QR...", "info");

            if (!html5QrcodeScanner) {
                html5QrcodeScanner = new Html5Qrcode("qr-reader");
            }
            
            if (isScanning) {
                await stopQrScanner();
            }

            try {
                // Attempt 1: Scan full image
                try {
                    const decodedText = await html5QrcodeScanner.scanFile(file, false);
                    onScanSuccess(decodedText, null);
                    input.value = ''; // Reset
                    return;
                } catch (e) {
                    console.log("Full image scan failed, trying crop...");
                }

                // Attempt 2: Crop Top-Right corner (CCCD standard location)
                const croppedFile = await cropToTopRight(file);
                if(croppedFile) {
                    try {
                        const decodedText = await html5QrcodeScanner.scanFile(croppedFile, false);
                        onScanSuccess(decodedText, null);
                        input.value = ''; // Reset
                        return;
                    } catch(e) {
                         // Attempt 3: If strict crop failed, maybe try a larger crop or center?
                         // For now just error out
                         console.warn("Cropped scan failed");
                    }
                }
                
                throw new Error("Cropped scan also failed");

            } catch (err) {
                console.error("File Scan Error:", err);
                showToast("Kh√¥ng t√¨m th·∫•y m√£ QR. H√£y ch·ª•p g·∫ßn m√£ QR h∆°n.", "warning");
                input.value = '';
            }
        }

        function cropToTopRight(file) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // CCCD QR is usually in the top right quadrant
                    // Let's crop the top-right 50% width and 50% height
                    // But to be safe in case of rotation, let's grab the top right quadrant
                    // Assuming Landscape photo:
                    
                    let isPortrait = img.height > img.width;
                    let sourceX, sourceY, sourceW, sourceH;

                    if (isPortrait) {
                        // If portrait, try top half, but QR location varies if user held card sideways
                        // Let's just try cropping top half for now
                         sourceX = 0;
                         sourceY = 0;
                         sourceW = img.width;
                         sourceH = img.height * 0.5;
                    } else {
                        // Landscape: Top Right
                        sourceX = img.width * 0.5; // Start from middle width
                        sourceY = 0;              // Start from top
                        sourceW = img.width * 0.5; // Take right half
                        sourceH = img.height * 0.6; // Take top 60%
                    }

                    canvas.width = sourceW;
                    canvas.height = sourceH;

                    ctx.drawImage(img, sourceX, sourceY, sourceW, sourceH, 0, 0, sourceW, sourceH);

                    canvas.toBlob((blob) => {
                        resolve(new File([blob], "cropped_qr.jpg", { type: "image/jpeg" }));
                    }, 'image/jpeg', 0.9);
                };
                img.onerror = () => resolve(null);
                img.src = URL.createObjectURL(file);
            });
        }

        function onScanSuccess(decodedText, decodedResult) {
            stopQrScanner();
            showToast("Qu√©t QR th√†nh c√¥ng!", "success");
            
            // Format: ID|LegacyID|Name|DOB|Gender|Address|IssueDate
            try {
                const parts = decodedText.split('|');
                if (parts.length >= 6) {
                    document.getElementById('cccd').value = parts[0] || "";
                    document.getElementById('fullname').value = parts[2] || "";
                    
                    if (parts[3] && parts[3].length === 8) {
                        document.getElementById('dob').value = formatQrDateToISO(parts[3]);
                    }

                    // Extract Gender (Index 4)
                    if (parts[4]) {
                        document.getElementById('gender').value = parts[4].trim();
                    }

                    document.getElementById('address').value = parts[5] || "";
                    
                    // Issue Date often at index 6
                    if (parts[6] && parts[6].length === 8) {
                        document.getElementById('issueDate').value = formatQrDateToISO(parts[6]);
                    }
                    
                    // Auto-fill Issue Place for Chip Cards if QR is valid
                    document.getElementById('issuePlace').value = "C·ª•c C·∫£nh s√°t QLHC v·ªÅ TTXH";
                } else {
                     showToast("QR kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng CCCD.", "warning");
                }
            } catch (e) {
                console.error("Parse error", e);
            }
        }

        // Converts QR date "ddmmyyyy" to "yyyy-mm-dd" for input[type="date"]
        function formatQrDateToISO(str) {
            return `${str.substring(4)}-${str.substring(2,4)}-${str.substring(0,2)}`;
        }

        // Converts OCR/Display date "dd/mm/yyyy" to "yyyy-mm-dd" for input[type="date"]
        function convertOcrDateToISO(dateStr) {
            if(!dateStr) return "";
            const parts = dateStr.split('/');
            if(parts.length === 3) {
                // Ensure yyyy-mm-dd
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            }
            return "";
        }

        // Converts "yyyy-mm-dd" back to "dd/mm/yyyy" for Webhook payload
        function formatISOToDisplay(isoStr) {
            if(!isoStr) return "";
            const parts = isoStr.split('-');
            if(parts.length === 3) {
                return `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
            return isoStr;
        }

        // --- IMAGE ROTATION & OCR LOGIC ---

        function handleImageUpload(input, side) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    // Create an image object to check dimensions
                    const img = new Image();
                    img.onload = function() {
                        // Logic to check orientation and rotate if necessary
                        let finalBase64 = '';
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Check if Portrait (Height > Width)
                        if (img.height > img.width) {
                            // Rotate 90 degrees clockwise to make it landscape
                            canvas.width = img.height;
                            canvas.height = img.width;
                            
                            // Transform context to rotate image
                            ctx.translate(canvas.width / 2, canvas.height / 2);
                            ctx.rotate(90 * Math.PI / 180); 
                            ctx.drawImage(img, -img.width / 2, -img.height / 2);
                            
                            // Get rotated image data
                            finalBase64 = canvas.toDataURL('image/jpeg', 0.9);
                        } else {
                            // Already Landscape or Square, use original
                            finalBase64 = e.target.result;
                        }

                        // UI Updates
                        const imgEl = document.getElementById(`img-${side}`);
                        const loadingEl = document.getElementById(`loading-${side}`);
                        const iconDiv = document.querySelector(`#preview-box-${side} div:first-child`);
                        const rotateBtn = document.getElementById(`btn-rotate-${side}`);
                        
                        imgEl.src = finalBase64;
                        imgEl.classList.remove('hidden');
                        
                        if(iconDiv) iconDiv.classList.add('hidden');
                        if(rotateBtn) rotateBtn.classList.remove('hidden'); // Show rotate button
                        
                        // Show loading overlay
                        loadingEl.classList.remove('hidden');
                        loadingEl.style.display = 'flex';

                        const base64Content = finalBase64.split(',')[1];
                        analyzeImageWithVision(base64Content, side);
                    };
                    img.src = e.target.result;
                }

                reader.readAsDataURL(file);
            }
        }

        // Function to rotate image 90 degrees clockwise manually
        function rotateImage(side) {
            const img = document.getElementById(`img-${side}`);
            if (!img.src) return;

            // Show loading
            document.getElementById(`loading-${side}`).classList.remove('hidden');
            document.getElementById(`loading-${side}`).style.display = 'flex';

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const image = new Image();

            image.onload = function() {
                // Swap width and height for 90 degree rotation
                canvas.width = image.height;
                canvas.height = image.width;

                // Translate and rotate
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(90 * Math.PI / 180);
                ctx.drawImage(image, -image.width / 2, -image.height / 2);

                const newBase64 = canvas.toDataURL('image/jpeg', 0.9);
                
                // Update UI
                img.src = newBase64;
                
                // Re-run OCR with new orientation
                const base64Content = newBase64.split(',')[1];
                analyzeImageWithVision(base64Content, side);
            };
            image.src = img.src;
        }

        async function analyzeImageWithVision(base64Image, side) {
            const url = `https://vision.googleapis.com/v1/images:annotate?key=${GOOGLE_API_KEY}`;
            const requestBody = {
                requests: [{
                    image: { content: base64Image },
                    features: [{ type: "TEXT_DETECTION" }],
                    imageContext: {
                        languageHints: ["vi"]
                    }
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                document.getElementById(`loading-${side}`).classList.add('hidden');
                document.getElementById(`loading-${side}`).style.display = 'none';

                if (data.responses && data.responses[0].fullTextAnnotation) {
                    const fullText = data.responses[0].fullTextAnnotation.text;
                    console.log(`OCR Result (${side}):`, fullText);
                    parseOCRData(fullText, side);
                    showToast(`ƒê√£ ƒë·ªçc xong ${side === 'front' ? 'm·∫∑t tr∆∞·ªõc' : 'm·∫∑t sau'}!`, "success");
                } else {
                    showToast(`Kh√¥ng t√¨m th·∫•y ch·ªØ ·ªü ${side === 'front' ? 'm·∫∑t tr∆∞·ªõc' : 'm·∫∑t sau'}.`, "warning");
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById(`loading-${side}`).classList.add('hidden');
                document.getElementById(`loading-${side}`).style.display = 'none';
                showToast("L·ªói k·∫øt n·ªëi OCR.", "error");
            }
        }

        function parseOCRData(text, side) {
            const lines = text.split('\n');
            const lowerText = text.toLowerCase();

            if (side === 'front') {
                // --- PARSE FRONT SIDE ---
                let idFound = false;
                
                // Aggressive ID search
                const cleanText = text.replace(/\s/g, '');
                const idMatch = cleanText.match(/\d{12}/);
                if (idMatch) {
                    document.getElementById('cccd').value = idMatch[0];
                    idFound = true;
                }

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const lowerLine = line.toLowerCase();

                    // Fallback ID
                    if (!idFound && (lowerLine.includes("s·ªë") || lowerLine.includes("no"))) {
                        const matches = line.match(/\d{12}/);
                        if (matches) document.getElementById('cccd').value = matches[0];
                    }

                    // Name
                    if (lowerLine.includes("h·ªç v√† t√™n") || lowerLine.includes("full name")) {
                        if (i + 1 < lines.length) {
                            let potentialName = lines[i+1].trim();
                            if (potentialName && potentialName === potentialName.toUpperCase() && potentialName.length > 3) {
                                document.getElementById('fullname').value = potentialName;
                            }
                        }
                    } 
                    // Fallback Name
                    else if (!document.getElementById('fullname').value && 
                             line === line.toUpperCase() && 
                             line.length > 5 && 
                             !line.includes("C·ªòNG H√íA") && 
                             !line.includes("ƒê·ªòC L·∫¨P") && 
                             !line.includes("CƒÇN C∆Ø·ªöC") &&
                             !line.includes("S·ªê / NO") &&
                             !/\d/.test(line)) {
                         document.getElementById('fullname').value = line;
                    }

                    // DOB
                    if (lowerLine.includes("sinh") || lowerLine.includes("birth")) {
                        const dateMatch = line.match(/\d{2}\/\d{2}\/\d{4}/);
                        if (dateMatch) {
                            document.getElementById('dob').value = convertOcrDateToISO(dateMatch[0]);
                        } else if (i + 1 < lines.length) {
                             const nextMatch = lines[i+1].match(/\d{2}\/\d{2}\/\d{4}/);
                             if (nextMatch) document.getElementById('dob').value = convertOcrDateToISO(nextMatch[0]);
                        }
                    }

                    // Gender (OCR Logic)
                    if (lowerLine.includes("gi·ªõi t√≠nh") || lowerLine.includes("sex")) {
                        if (lowerLine.includes("nam")) document.getElementById('gender').value = "Nam";
                        else if (lowerLine.includes("n·ªØ")) document.getElementById('gender').value = "N·ªØ";
                    }
                    
                    // Address
                    if (lowerLine.includes("th∆∞·ªùng tr√∫") || lowerLine.includes("c∆∞ tr√∫") || lowerLine.includes("residence")) {
                         let addr = "";
                         for(let j=1; j<=3; j++) {
                             if(i + j < lines.length) {
                                 const nextLine = lines[i+j];
                                 if(nextLine.includes("C√≥ gi√° tr·ªã") || nextLine.includes("Date of expiry") || nextLine.match(/\d{2}\/\d{2}\/\d{4}/)) break;
                                 addr += nextLine + ", ";
                             }
                         }
                         addr = addr.replace(/,$/, '').trim();
                         if (addr.length > 5) document.getElementById('address').value = addr;
                    }
                }
            } 
            else if (side === 'back') {
                // --- PARSE BACK SIDE ---
                
                // 1. Issue Date
                const dateRegex = /ng√†y\s+(\d{1,2})\s+th√°ng\s+(\d{1,2})\s+nƒÉm\s+(\d{4})/i;
                const match = text.match(dateRegex);
                
                if (match) {
                    const day = match[1].padStart(2, '0');
                    const month = match[2].padStart(2, '0');
                    const year = match[3];
                    document.getElementById('issueDate').value = `${year}-${month}-${day}`;
                } else {
                    const allDates = text.match(/\d{2}\/\d{2}\/\d{4}/g);
                    if (allDates && allDates.length > 0) {
                        document.getElementById('issueDate').value = convertOcrDateToISO(allDates[allDates.length - 1]);
                    }
                }

                // 2. Address (New CCCD)
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const lowerLine = line.toLowerCase();
                    
                    if (lowerLine.includes("n∆°i c∆∞ tr√∫") || lowerLine.includes("place of residence")) {
                        let addr = "";
                        for (let j = 1; j < 5; j++) {
                            if (i + j < lines.length) {
                                const nextLine = lines[i+j].trim();
                                const lowerNext = nextLine.toLowerCase();
                                if (lowerNext.includes("n∆°i ƒëƒÉng k√Ω khai sinh") || lowerNext.includes("place of birth") || lowerNext.includes("b·ªô c√¥ng an")) break;
                                if (!nextLine.match(/\d{2}\/\d{2}\/\d{4}/)) addr += nextLine + ", ";
                            }
                        }
                        addr = addr.replace(/,$/, '').trim();
                        if (addr.length > 5) {
                            document.getElementById('address').value = addr;
                            break; 
                        }
                    }
                }

                // 3. Issue Place
                if (lowerText.includes("c·ª•c c·∫£nh s√°t") || lowerText.includes("police")) {
                    document.getElementById('issuePlace').value = "C·ª•c C·∫£nh s√°t QLHC v·ªÅ TTXH";
                } else if (lowerText.includes("b·ªô c√¥ng an") || lowerText.includes("ministry of public security")) {
                    document.getElementById('issuePlace').value = "B·ªò C√îNG AN";
                } else if (lowerText.includes("c√¥ng an")) {
                    const caMatch = text.match(/C√¥ng an\s+([^\n]+)/i);
                    if (caMatch) document.getElementById('issuePlace').value = caMatch[0];
                    else document.getElementById('issuePlace').value = "C√¥ng an T·ªânh/TP";
                }
            }
        }

        // --- RESET PAGE LOGIC ---
        function resetPage() {
            if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·∫øt th√¥ng tin ƒë·ªÉ nh·∫≠p l·∫°i t·ª´ ƒë·∫ßu kh√¥ng?")) {
                performReset();
                showToast("ƒê√£ x√≥a tr·∫Øng th√¥ng tin!", "info");
            }
        }

        function performReset() {
            document.getElementById('employeeForm').reset();
            document.getElementById('file-front').value = "";
            document.getElementById('file-back').value = "";
            document.getElementById('qr-input-file').value = "";
            // Reset date to today
            document.getElementById('registerDate').valueAsDate = new Date();
            // Reset gender
            document.getElementById('gender').selectedIndex = 0;

            const resetImage = (side) => {
                const img = document.getElementById(`img-${side}`);
                const icon = document.querySelector(`#preview-box-${side} div:first-child`);
                const loading = document.getElementById(`loading-${side}`);
                const rotateBtn = document.getElementById(`btn-rotate-${side}`);
                
                if(img) { img.src = ""; img.classList.add('hidden'); }
                if(icon) { icon.classList.remove('hidden'); }
                if(loading) { loading.classList.add('hidden'); loading.style.display = 'none'; }
                if(rotateBtn) { rotateBtn.classList.add('hidden'); }
            };
            resetImage('front');
            resetImage('back');

            if(isScanning) { stopQrScanner(); }
            
            document.getElementById('company').selectedIndex = 0;
            document.getElementById('supplier').selectedIndex = 0;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- SUBMIT TO N8N ---
        async function submitForm(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const originalBtnContent = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<div class="loader w-5 h-5 border-2 border-t-white border-transparent mr-2"></div> ƒêang g·ª≠i...`;

            const dobVal = document.getElementById('dob').value;
            const issueVal = document.getElementById('issueDate').value;
            const regDateVal = document.getElementById('registerDate').value;
            
            const imgFront = document.getElementById('img-front').src;
            const imgBack = document.getElementById('img-back').src;
            const cleanImgFront = (imgFront && imgFront.startsWith('data:')) ? imgFront : "";
            const cleanImgBack = (imgBack && imgBack.startsWith('data:')) ? imgBack : "";

            const formData = {
                company: document.getElementById('company').value,
                supplier: document.getElementById('supplier').value,
                registerDate: formatISOToDisplay(regDateVal), // Add register date
                fullname: document.getElementById('fullname').value,
                cccd: document.getElementById('cccd').value,
                dob: formatISOToDisplay(dobVal),
                gender: document.getElementById('gender').value, // Add gender
                issueDate: formatISOToDisplay(issueVal),
                issuePlace: document.getElementById('issuePlace').value,
                address: document.getElementById('address').value,
                phone: document.getElementById('phone').value,
                notes: document.getElementById('notes').value, // Add notes
                image_front: cleanImgFront,
                image_back: cleanImgBack,
                timestamp: new Date().toISOString()
            };

            try {
                await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                showToast("ƒê√£ g·ª≠i th√¥ng tin l√™n h·ªá th·ªëng!", "success");
                performReset();
            } catch (error) {
                console.error("Webhook Error:", error);
                if (error.message.includes('Failed to fetch')) {
                     showToast("L·ªói CORS ho·∫∑c M·∫°ng. Ki·ªÉm tra n8n ƒë√£ b·∫≠t CORS ch∆∞a.", "warning");
                } else {
                     showToast("L·ªói k·∫øt n·ªëi m·∫°ng.", "error");
                }
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalBtnContent;
            }
        }

        // --- UTILS ---
        function showToast(message, type = "info") {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            let bgClass = "bg-gray-800";
            let icon = '<i class="fa-solid fa-info-circle"></i>';
            if (type === "success") { bgClass = "bg-green-600"; icon = '<i class="fa-solid fa-check-circle"></i>'; }
            if (type === "error") { bgClass = "bg-red-600"; icon = '<i class="fa-solid fa-exclamation-circle"></i>'; }
            if (type === "warning") { bgClass = "bg-yellow-600"; icon = '<i class="fa-solid fa-exclamation-triangle"></i>'; }

            toast.className = `${bgClass} text-white px-4 py-3 rounded-lg shadow-lg mb-3 flex items-center gap-3 text-sm transition-all duration-500 transform translate-y-10 opacity-0`;
            toast.innerHTML = `${icon} <span>${message}</span>`;
            
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        // Initialize Date Input with Today
        document.addEventListener('DOMContentLoaded', (event) => {
             document.getElementById('registerDate').valueAsDate = new Date();
        });
    </script>
</body>
</html>
